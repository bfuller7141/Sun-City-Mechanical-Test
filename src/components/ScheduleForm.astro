---
import BaseHead from "./BaseHead.astro";
import SkipToMain from "./SkipToMain.astro";
import '../styles/global.css';
import MainNav from "./MainNav.astro";

// Define the Flatpickr type
declare global {
  interface Window {
    flatpickr: any;
    grecaptcha: any;
  }
}
---
<html lang="en">
<head>
  <BaseHead
  title="Schedule a Service | Sun City Mechanical"
  description="Schedule your HVAC service with Sun City Mechanical, serving Buckeye, Peoria, Surprise, Goodyear, Sun City, and surrounding areas."
  keywords="schedule a service, HVAC, heating, cooling, plumbing, West Valley, Buckeye, Peoria, Surprise, Goodyear, Sun City, Sun City West, Avondale, El Mirage, Arizona"
  image="/path-to-schedule-image.jpg"
  url="https://www.suncitymechanical.com/schedule"  
  />
  <meta name="author" content="Tripass Design" />
  <!-- Flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <!-- reCAPTCHA v3 Script -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LdLUykqAAAAALdBQc4YiSG2RwI63H7onrLJ9ZDH"></script>
</head>
<body>
  <script src="/src/scripts/navbar.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <SkipToMain />
  <header>
    <MainNav />
  </header>
  <main id="main-content">
    <section class="scheduling-form-section">
        <div class="large-top">
            <div class="container">
                <div class="wrapper center">
                <h1 class="page-title">Schedule A Service</h1>
                <div class="line margin-bottom"></div>
                </div>
            </div>
            <div class="container blog">
            <form 
            name="service-scheduling" 
            method="POST" 
            data-netlify="true" 
            data-netlify-honeypot="bot-field"
            class="scheduling-form"
            >
            <input type="hidden" name="form-name" value="service-scheduling" />
        
            <!-- Hide the "Don't fill this out" field -->
            <div class="hidden" style="display: none;">
                <label>Donâ€™t fill this out if you're human: <input name="bot-field" /></label>
            </div>
        
            <!-- First Name and Last Name -->
            <div class="form-row">
                <div class="form-group">
                <label for="first-name">First Name*</label>
                <input type="text" id="first-name" name="first-name" class="text-field" placeholder="John" autocomplete="given-name" required />
                </div>
                <div class="form-group">
                <label for="last-name">Last Name*</label>
                <input type="text" id="last-name" name="last-name" class="text-field" placeholder="Doe" autocomplete="family-name" required />
                </div>
            </div>
        
            <!-- Email -->
            <div class="form-group">
                <label for="email">Email*</label>
                <input type="email" id="email" name="email" class="text-field" placeholder="john.doe@example.com" autocomplete="email" required />
            </div>
        
            <!-- Phone Number -->
            <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" name="phone" class="text-field" placeholder="(123) 456-7890" autocomplete="tel" />
            </div>
        
            <!-- City, State, and Zip Code -->
            <div class="form-row">
                <div class="form-group">
                <label for="city">City*</label>
                <input type="text" id="city" name="city" class="text-field" placeholder="Phoenix" autocomplete="address-level2" required />
                </div>
                <div class="form-group">
                <label for="state">State*</label>
                <select id="state" name="state" class="text-field" autocomplete="address-level1" required>
                    <option value="AZ" selected>Arizona</option>
                </select>
                </div>
                <div class="form-group">
                <label for="zip">Zip Code*</label>
                <input type="text" id="zip" name="zip" class="text-field" placeholder="85001" autocomplete="postal-code" required />
                </div>
            </div>
        
            <!-- Type of Service -->
            <div class="form-group">
                <label for="service-type">Type of Service*</label>
                <select id="service-type" name="service-type" class="text-field" required>
                <option value="" disabled selected>Select a service</option>
                <option value="heating">Heating</option>
                <option value="cooling">Cooling</option>
                <option value="air-quality">Air Quality</option>
                </select>
            </div>
        
            <!-- Preferred Dates -->
            <div class="form-row">
                <div class="form-group">
                <label for="preferred-date-1">Preferred Date 1*</label>
                <input type="text" id="preferred-date-1" name="preferred-date-1" class="text-field flatpickr-input" placeholder="mm/dd/yy" required />
                </div>
                <div class="form-group">
                <label for="preferred-date-2">Preferred Date 2*</label>
                <input type="text" id="preferred-date-2" name="preferred-date-2" class="text-field flatpickr-input" placeholder="mm/dd/yy" required />
                </div>
                <div class="form-group">
                <label for="preferred-date-3">Preferred Date 3</label>
                <input type="text" id="preferred-date-3" name="preferred-date-3" class="text-field flatpickr-input" placeholder="mm/dd/yy" />
                </div>
            </div>
        
            <!-- Additional Comments -->
            <div class="form-group">
                <label for="comments">Additional Comments</label>
                <textarea id="comments" name="comments" class="text-field" placeholder="Enter any additional information here..."></textarea>
            </div>

            <!-- reCAPTCHA response token -->
            <input type="hidden" name="g-recaptcha-response" id="g-recaptcha-response">
        
            <!-- Submit Button -->
            <div class="form-group">
                <button type="submit" class="btn">Submit</button>
            </div>
            </form>
        </div>
    </div>
    </section>
    
    <style>
      .scheduling-form {
        display: grid;
        gap: var(--spacing-lg);
      }
    
      .form-group, .form-row {
        display: flex;
        flex-direction: column;
        width: 100%;
      }
      
      .form-row {
        flex-direction: row;
        gap: var(--spacing-lg);
      }
    
      label {
        font-size: var(--font-lg);
        color: var(--dark-blue-500);
        margin-bottom: var(--spacing-xs);
        font-family: 'neue-haas-grotesk-text', sans-serif;
      }
    
      .text-field {
        padding: var(--spacing-sm);
        font-size: var(--font-md);
        font-family: 'neue-haas-grotesk-text', sans-serif;
        color: var(--navy);
        border: 2px solid var(--blue-500);
        border-radius: 0.25rem;
        background-color: transparent;
        transition: border-color 0.3s ease, background-color 0.3s ease;
        width: 100%;
      }
    
      .text-field:focus, .text-field:hover {
        outline: none;
        border-color: var(--light-blue-500);
        background-color: transparent;
      }
    
      button.btn-red {
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: var(--font-lg);
        background-color: var(--red-500);
        color: var(--white);
        border: none;
        border-radius: 0.125rem;
        cursor: pointer;
        transition: background-color 0.3s ease;
        width: 100%;
      }
    
      button.btn-red:hover {
        background-color: var(--red-700);
      }
    
      /* Responsive styles */
      @media (max-width: 768px) {
        .scheduling-form {
          grid-template-columns: 1fr;
        }
        .form-row {
          flex-direction: column;
        }
      }
    
      /* Error Tooltip */
      .error-tooltip {
        position: relative;
        display: inline-block;
        border-bottom: 1px dotted black;
      }
    
      .error-tooltip .tooltiptext {
        visibility: hidden;
        width: 120px;
        background-color: var(--red-500);
        color: var (--white);
        text-align: center;
        border-radius: 0.125rem;
        padding: 5px 0;
        position: absolute;
        z-index: 1;
        bottom: 125%; 
        left: 50%;
        margin-left: -60px;
        opacity: 0;
        transition: opacity 0.3s;
      }
    
      .error-tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
      }

      /* Flatpickr styling to match the input fields */
      .flatpickr-input {
        border: 2px solid var(--blue-500);
        border-radius: 0.25rem;
        background-color: transparent;
        transition: border-color 0.3s ease, background-color 0.3s ease;
        width: 100%;
      }
      
      .flatpickr-input:focus, .flatpickr-input:hover {
        outline: none;
        border-color: var(--light-blue-500);
        background-color: transparent;
      }
    </style>
    
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const options = {
          mode: "single",
          dateFormat: "m/d/y",  // Change date format to mm/dd/yy
          minDate: "today",
          maxDate: new Date().setMonth(new Date().getMonth() + 3),
          onOpen: function(selectedDates: Date[], dateStr: string, instance: any) {
            instance.calendarContainer.style.display = 'block';
          },
          onClose: function(selectedDates: Date[], dateStr: string, instance: any) {
            instance.calendarContainer.style.display = 'none';
          }
        };
        
        window.flatpickr("#preferred-date-1", options);
        window.flatpickr("#preferred-date-2", options);
        window.flatpickr("#preferred-date-3", options);
    
        // Error tooltip handling
        document.querySelectorAll('.form-group input[required], .form-group select[required], .form-group textarea[required]').forEach(input => {
          input.addEventListener('invalid', (event) => {
            event.preventDefault();
            const targetInput = event.target as HTMLInputElement;
            targetInput.classList.add('error');
            targetInput.focus();
        
            const tooltip = document.createElement('div');
            tooltip.classList.add('tooltiptext');
            tooltip.textContent = `${targetInput.name.replace('-', ' ')} is required`;
            const formGroup = targetInput.closest('.form-group');
            if (formGroup) {
              formGroup.appendChild(tooltip);
            }
        
            setTimeout(() => {
              tooltip.remove();
              targetInput.classList.remove('error');
            }, 3000);
          });
        });
    
        // reCAPTCHA handling
        (window as any).grecaptcha.ready(function() {
          (window as any).grecaptcha.execute('6LdLUykqAAAAALdBQc4YiSG2RwI63H7onrLJ9ZDH', {action: 'submit'}).then(function(token: string) {
              const recaptchaResponse = document.getElementById('g-recaptcha-response') as HTMLInputElement | null;
              if (recaptchaResponse) {
                  recaptchaResponse.value = token;
              }
          });
        });
      });
    </script>
  </main>
</body>
</html>
